<div class="dashboard-header">
    <h3>Lịch hẹn</h3>
    <ul class="header-list-btns">
        <li>
            <div class="input-block dash-search-input">
                <input type="text" class="form-control" placeholder="Tìm kiếm">
                <span class="search-icon"><i class="isax isax-search-normal"></i></span>
            </div>
        </li>
        <li>
            <div class="view-icons">
                <a href="javascript:void(0);" class="active"><i class="isax isax-grid-7"></i></a>
            </div>
        </li>
        <li>
            <div class="view-icons">
                <a href="javascript:void(0);"><i class="fa-solid fa-th"></i></a>
            </div>
        </li>
    </ul>
</div>

<div class="appointment-tab-head">
    <div class="appointment-tabs">
        <ul class="nav nav-pills inner-tab" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-pending-tab" data-bs-toggle="pill"
                    data-bs-target="#pills-pending" type="button" role="tab" aria-controls="pills-pending"
                    aria-selected="true">Chờ xác nhận<span>{{ pendingAppointments.length }}</span></button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-confirmed-tab" data-bs-toggle="pill"
                    data-bs-target="#pills-confirmed" type="button" role="tab" aria-controls="pills-confirmed"
                    aria-selected="false">Đã xác nhận<span>{{ confirmedAppointments.length }}</span></button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-cancel-tab" data-bs-toggle="pill" data-bs-target="#pills-cancel"
                    type="button" role="tab" aria-controls="pills-cancel" aria-selected="false">Đã hủy<span>{{
                        cancelledAppointments.length }}</span></button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-complete-tab" data-bs-toggle="pill"
                    data-bs-target="#pills-complete" type="button" role="tab" aria-controls="pills-complete"
                    aria-selected="false">Hoàn thành<span>{{ completedAppointments.length }}</span></button>
            </li>
        </ul>
    </div>
    <div class="filter-head">
        <div class="position-relative daterange-wraper me-2">
            <div class="input-groupicon calender-input">
                <input type="text" class="form-control date-range bookingrange" placeholder="From Date - To Date">
            </div>
            <i class="isax isax-calendar-1"></i>
        </div>
        <div class="form-sorts dropdown">
            <a href="javascript:void(0);" class="dropdown-toggle" id="table-filter"><i
                    class="isax isax-filter me-2"></i>Filter By</a>
            <div class="filter-dropdown-menu">
                <div class="filter-set-view">
                    <div class="accordion" id="accordionExample">
                        <div class="filter-set-content">
                            <div class="filter-set-content-head">
                                <a href="#" data-bs-toggle="collapse" data-bs-target="#collapseTwo"
                                    aria-expanded="false" aria-controls="collapseTwo">Name<i
                                        class="fa-solid fa-chevron-right"></i></a>
                            </div>
                            <div class="filter-set-contents accordion-collapse collapse show" id="collapseTwo"
                                data-bs-parent="#accordionExample">
                                <ul>
                                    <li>
                                        <div class="input-block dash-search-input w-100">
                                            <input type="text" class="form-control" placeholder="Search">
                                            <span class="search-icon"><i
                                                    class="fa-solid fa-magnifying-glass"></i></span>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="filter-reset-btns">
                        <a href="javascript:void(0);" class="btn btn-md btn-light rounded-pill">Reset</a>
                        <a href="javascript:void(0);" class="btn btn-md btn-primary-gradient rounded-pill">Filter
                            Now</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="tab-content appointment-tab-content">
    <!-- Pending Tab -->
    <div class="tab-pane fade show active" id="pills-pending" role="tabpanel" aria-labelledby="pills-pending-tab">
        @if (loading.pending) {
        <div class="text-center py-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Đang tải...</span>
            </div>
        </div>
        }

        @if (!loading.pending && pendingAppointments.length === 0) {
        <div class="text-center py-5">
            <p>Không có lịch hẹn chờ xác nhận</p>
        </div>
        }

        @for (appointment of pendingAppointments; track appointment.appointmentId) {
        <div class="appointment-wrap">
            <ul>
                <li>
                    <div class="patinet-information">
                        <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                            <img [src]="appointment.doctorAvatar || 'assets/img/doctors/doctor-thumb-02.jpg'"
                                [alt]="appointment.doctorName || 'Doctor'">
                        </a>
                        <div class="patient-info">
                            <p>{{ appointment.publicCode }}</p>
                            <h6>
                                <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                                    {{ appointment.doctorName || 'Doctor' }}
                                </a>
                            </h6>
                        </div>
                    </div>
                </li>
                <li class="appointment-info">
                    <p><i class="isax isax-clock5"></i>{{ formatDate(appointment.appointmentDate) }} {{
                        formatTime(appointment.startTime) }}</p>
                    <ul class="d-flex apponitment-types">
                        <li>{{ appointment.specialtyName || 'General Visit' }}</li>
                        <li>{{ formatPrice(appointment.consultationFee) }}</li>
                    </ul>
                </li>
                <li class="mail-info-patient">
                    <ul>
                        @if(appointment.doctorEmail){
                        <li>
                            <i class="isax isax-sms5"></i>
                            <a [href]="'mailto:' + appointment.doctorEmail">{{ appointment.doctorEmail}}</a>
                        </li>
                        }
                        @if(appointment.doctorPhone){
                        <li>
                            <i class="isax isax-call5"></i>{{ appointment.doctorPhone }}
                        </li>
                        }
                    </ul>
                </li>
                <li class="appointment-action">
                    <ul>
                        <li>
                            <a [routerLink]="['/patient/appointments', appointment.appointmentId]">
                                <i class="isax isax-eye4"></i>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="appointment-detail-btn">
                    <span class="badge badge-lg" [ngClass]="getStatusClass(appointment.status)">
                        {{ getStatusText(appointment.status) }}
                    </span>
                </li>
            </ul>
        </div>
        }
    </div>

    <!-- Confirmed Tab -->
    <div class="tab-pane fade" id="pills-confirmed" role="tabpanel" aria-labelledby="pills-confirmed-tab">
        @if(loading.confirmed){
        <div class="text-center py-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Đang tải...</span>
            </div>
        </div>
        }

        @if(!loading.confirmed && confirmedAppointments.length === 0){
        <div class="text-center py-5">
            <p>Không có lịch hẹn đã xác nhận</p>
        </div>
        }

        @for(appointment of confirmedAppointments; track appointment.appointmentId){
        <div class="appointment-wrap">
            <ul>
                <li>
                    <div class="patinet-information">
                        <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                            <img [src]="appointment.doctorAvatar || 'assets/img/doctors/doctor-thumb-02.jpg'"
                                [alt]="appointment.doctorName || 'Doctor'">
                        </a>
                        <div class="patient-info">
                            <p>{{ appointment.publicCode }}</p>
                            <h6>
                                <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                                    {{ appointment.doctorName || 'Bác sĩ' }}
                                </a>
                            </h6>
                        </div>
                    </div>
                </li>
                <li class="appointment-info">
                    <p><i class="isax isax-clock5"></i>{{ formatDate(appointment.appointmentDate) }} {{
                        formatTime(appointment.startTime) }}</p>
                    <ul class="d-flex apponitment-types">
                        <li>{{ appointment.specialtyName || 'Khám tổng quát' }}</li>
                        <li>{{ formatPrice(appointment.consultationFee) }}</li>
                    </ul>
                </li>
                <li class="mail-info-patient">
                    <ul>
                        @if(appointment.doctorEmail){
                        <li>
                            <i class="isax isax-sms5"></i>
                            <a [href]="'mailto:' + appointment.doctorEmail">{{ appointment.doctorEmail}}</a>
                        </li>
                        }
                        @if(appointment.doctorPhone){
                        <li>
                            <i class="isax isax-call5"></i>{{ appointment.doctorPhone }}
                        </li>
                        }
                    </ul>
                </li>
                <li class="appointment-action">
                    <ul>
                        <li>
                            <a [routerLink]="['/patient/appointments', appointment.appointmentId]">
                                <i class="isax isax-eye4"></i>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="appointment-detail-btn">
                    <span class="badge badge-lg" [ngClass]="getStatusClass(appointment.status)">
                        {{ getStatusText(appointment.status) }}
                    </span>
                </li>
            </ul>
        </div>
        }
    </div>

    <!-- Cancelled Tab -->
    <div class="tab-pane fade" id="pills-cancel" role="tabpanel" aria-labelledby="pills-cancel-tab">
        @if(loading.cancelled){
        <div class="text-center py-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Đang tải...</span>
            </div>
        </div>
        }

        @if(!loading.cancelled && cancelledAppointments.length === 0){
        <div class="text-center py-5">
            <p>Không có lịch hẹn đã hủy</p>
        </div>
        }

        @for(appointment of cancelledAppointments; track appointment.appointmentId){
        <div class="appointment-wrap">
            <ul>
                <li>
                    <div class="patinet-information">
                        <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                            <img [src]="appointment.doctorAvatar || 'assets/img/doctors/doctor-thumb-02.jpg'"
                                [alt]="appointment.doctorName || 'Doctor'">
                        </a>
                        <div class="patient-info">
                            <p>{{ appointment.publicCode }}</p>
                            <h6>
                                <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                                    {{ appointment.doctorName || 'Bác sĩ' }}
                                </a>
                            </h6>
                        </div>
                    </div>
                </li>
                <li class="appointment-info">
                    <p><i class="isax isax-clock5"></i>{{ formatDate(appointment.appointmentDate) }} {{
                        formatTime(appointment.startTime) }}</p>
                    <ul class="d-flex apponitment-types">
                        <li>{{ appointment.specialtyName || 'Khám tổng quát' }}</li>
                        <li>{{ formatPrice(appointment.consultationFee) }}</li>
                    </ul>
                </li>
                <li class="mail-info-patient">
                    <ul>
                        @if(appointment.doctorEmail){
                        <li>
                            <i class="isax isax-sms5"></i>
                            <a [href]="'mailto:' + appointment.doctorEmail">{{ appointment.doctorEmail}}</a>
                        </li>
                        }
                        @if(appointment.doctorPhone){
                        <li>
                            <i class="isax isax-call5"></i>{{ appointment.doctorPhone }}
                        </li>
                        }
                    </ul>
                </li>
                <li class="appointment-action">
                    <ul>
                        <li>
                            <a [routerLink]="['/patient/appointments', appointment.appointmentId]">
                                <i class="isax isax-eye4"></i>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="appointment-detail-btn">
                    <span class="badge badge-lg" [ngClass]="getStatusClass(appointment.status)">
                        {{ getStatusText(appointment.status) }}
                    </span>
                </li>
            </ul>
        </div>
        }
    </div>

    <!-- Completed Tab -->
    <div class="tab-pane fade" id="pills-complete" role="tabpanel" aria-labelledby="pills-complete-tab">
        @if(loading.completed){
        <div class="text-center py-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Đang tải...</span>
            </div>
        </div>
        }

        @if(!loading.completed && completedAppointments.length === 0){
        <div class="text-center py-5">
            <p>Không có lịch hẹn đã hoàn thành</p>
        </div>
        }

        @for(appointment of completedAppointments; track appointment.appointmentId){
        <div class="appointment-wrap">
            <ul>
                <li>
                    <div class="patinet-information">
                        <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                            <img [src]="appointment.doctorAvatar || 'assets/img/doctors/doctor-thumb-02.jpg'"
                                [alt]="appointment.doctorName || 'Doctor'">
                        </a>
                        <div class="patient-info">
                            <p>{{ appointment.publicCode }}</p>
                            <h6>
                                <a [routerLink]="['/doctor-profile', appointment.doctorId]">
                                    {{ appointment.doctorName || 'Bác sĩ' }}
                                </a>
                            </h6>
                        </div>
                    </div>
                </li>
                <li class="appointment-info">
                    <p><i class="isax isax-clock5"></i>{{ formatDate(appointment.appointmentDate) }} {{
                        formatTime(appointment.startTime) }}</p>
                    <ul class="d-flex apponitment-types">
                        <li>{{ appointment.specialtyName || 'Khám tổng quát' }}</li>
                        <li>{{ formatPrice(appointment.consultationFee) }}</li>
                    </ul>
                </li>
                <li>
                    <a href="javascript:void(0);" class="text-decoration-underline">Đánh giá</a>
                </li>
                <li class="appointment-detail-btn d-flex align-items-center gap-3 flex-wrap">
                    <a [routerLink]="['/booking']" [queryParams]="{doctorId: appointment.doctorId}"
                        class="btn btn-md btn-dark">Đặt lại<i class="isax isax-arrow-right-3 ms-1"></i></a>
                    <a [routerLink]="['/patient/appointments', appointment.appointmentId]"
                        class="btn btn-md btn-primary-gradient">Xem chi tiết<i
                            class="isax isax-arrow-right-3 ms-1"></i></a>
                </li>
            </ul>
        </div>
        }
    </div>
</div>
